{% extends "base.html" %}
{% block content %}
<h2>üöö –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è</h2>

{% if no_driver %}
  <div class="alert alert-warning">
    –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–¥–∏—Ç–µ–ª—è. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
  </div>
{% else %}
  {% if not active_order %}
    <div class="alert alert-info">
      <b>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</b>
    </div>
  {% else %}
    <div class="order-card">
      <h3>–ó–∞–∫–∞–∑ #{{ active_order.id }}</h3>
      <p><strong>–û—Ç–∫—É–¥–∞:</strong> {{ active_order.from_address }}</p>
      <p><strong>–ö—É–¥–∞:</strong> {{ active_order.to_address }}</p>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–µ–π -->
    <form method="post" class="action-form">
      {% csrf_token %}
      <input type="hidden" name="lat" id="lat">
      <input type="hidden" name="lng" id="lng">
      <button type="submit" name="share_location" class="btn btn-location">üìç –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–µ–π</button>
    </form>

    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <form method="post" enctype="multipart/form-data" class="action-form">
      {% csrf_token %}
      <label class="file-label">
        üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
        <input type="file" name="document" required hidden>
      </label>
      <button type="submit" name="upload_doc" class="btn btn-upload">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
    <form method="post" class="action-form">
      {% csrf_token %}
      <button type="submit" name="finish_order" class="btn btn-finish"
        onclick="return confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑?');">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  {% endif %}
{% endif %}

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –±—Ä–∞—É–∑–µ—Ä–æ–º
document.querySelector("button[name='share_location']")?.addEventListener("click", function(e){
    e.preventDefault();
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(pos){
            document.getElementById("lat").value = pos.coords.latitude;
            document.getElementById("lng").value = pos.coords.longitude;
            e.target.closest("form").submit();
        }, function(err){
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é: " + err.message);
        });
    } else {
        alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.");
    }
});
</script>
{% endblock %}
