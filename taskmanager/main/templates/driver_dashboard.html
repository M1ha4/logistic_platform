{% extends "base.html" %}

{% block content %}
<h2>–ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>
<ul>
  {% for order in orders %}
    <li>{{ order.from_address }} ‚Üí {{ order.to_address }} | {{ order.status }}</li>
  {% endfor %}
</ul>

<h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h3>
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</form>



<script>
function startTracking() {
    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(function(position) {
            fetch("/api/update-location/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                })
            }).then(r => console.log("Location sent"));
        });
    } else {
        alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
    }
}
</script>

<button onclick="startTracking()">üöö –ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</button>

{% endblock %}